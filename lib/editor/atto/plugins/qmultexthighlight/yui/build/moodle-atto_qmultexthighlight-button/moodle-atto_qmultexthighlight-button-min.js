YUI.add("moodle-atto_qmultexthighlight-button",function(e,t){var n="atto_qmultexthighlight";e.namespace("M.atto_qmultexthighlight").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(t){var r=[];e.Object.each(t.styles,function(e){var t="";e.class!==""&&(t=" "+e.attr+'="'+e.attrValue+'" ');var i="";e.tagname!==""?i="<"+e.tagname+t+">"+M.util.get_string(e.stylename,n)+"</"+e.tagname+">":i='<div class="removehighlight">'+M.util.get_string(e.stylename,n)+"</div>",r.push({text:i,callbackArgs:{tagname:e.tagname,attr:e.attr,attrValue:e.attrValue}})}),this.addToolbarMenu({icon:"e/text_highlight",globalItemConfig:{callback:this._changeStyle},items:r})},_changeStyle:function(e,t){var n="";t.classname!==""&&(n=" "+t.attr+'="'+t.attrValue+'" ');var r=window.getSelection(),i="";window.getSelection&&window.getSelection().toString()?i=window.getSelection():document.getSelection&&document.getSelection().toString()?i=document.getSelection():(r=document.selection&&document.selection.createRange(),typeof r!="undefined"&&r.text&&r.text.toString()&&(i=r.text)),t.tagname!==""&&i!==""?this._pasteHtmlAtCaret("<"+t.tagname+" "+n+' class="qmhighlighted">'+i+"</"+t.tagname+">"):i!==""&&this._pasteHtmlAtCaret(i.toString()),this.markUpdated(),this.markUpdated()},_pasteHtmlAtCaret:function(e){var t,n;if(window.getSelection){t=window.getSelection(),console.log(t);if(t.getRangeAt&&t.rangeCount){n=t.getRangeAt(0);if(t.anchorNode.parentNode&&t.anchorNode.parentNode.id.indexOf("highlight-")>=0){var r=t.anchorNode.parentNode;r.parentNode.removeChild(r)}n.deleteContents();var i=document.createElement("div");i.innerHTML=e;var s=document.createDocumentFragment(),o,u;while(o=i.firstChild)u=s.appendChild(o);var a=s.firstChild;return n.insertNode(s),!0}}else if((t=document.selection)&&t.type!="Control"){var f=t.createRange();f.collapse(!0),t.createRange().pasteHTML(e),selectPastedContent&&(n=t.createRange(),n.setEndPoint("StartToStart",f),n.select())}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
