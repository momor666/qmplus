YUI.add("moodle-atto_qmulcolumns-button",function(e,t){var n="atto_qmulcolumns",r={COLUMN:"atto_qmulcolumns_column",MAP:"atto_qmulcolumns_map"},i={COLUMN:".atto_qmulcolumns_column"},s='<div class="{{CSS.MAP}}">{{#each styles}}<div><a href="#" class="{{../CSS.COLUMN}}" data-tagname="{{tagname}}" data-attr="{{attr}}" data-attrValue="{{attrValue}}">{{get_string stylename "atto_qmulcolumns"}}</a></div>{{/each}}</div>';e.namespace("M.atto_qmulcolumns").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,initializer:function(){this.addButton({icon:"e/columns",iconComponent:"atto_qmulcolumns",callback:this._displayDialogue})},_displayDialogue:function(){this._currentSelection=this.get("host").getSelection();if(this._currentSelection===!1)return;var e=this.getDialogue({headerContent:M.util.get_string("insertcolumn",n),focusAfterHide:!0},!0);e.set("bodyContent",this._getDialogueContent()).show()},_insertCol:function(e){var t=e.target.ancestor(i.COLUMN,!0),n=this.get("host"),r=t.getData("attr"),s=t.getData("attrValue"),o="";e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),r=="class"?s+=" atto-editor-columnborder":o='class="atto-editor-columnborder"';var u=s.split(",");if(u.length>0){var a=(100-(u.length-1)*2)/u.length;if(u.length===1)var f='<table class="onecolumntable"><tr>';else var f="<table><tr>";var l=0;u.forEach(function(){l++>0&&(f+='<td class="qmulcolumn-separator"></td>'),f=f+'<td class="qmulcolumn" style="width:'+a+'%;">Column '+l+"</td>"}),f+="</tr></table>"}var c,h;window.getSelection&&window.getSelection().getRangeAt?(c=window.getSelection().getRangeAt(0),h=c.createContextualFragment(f),c.insertNode(h)):document.selection&&document.selection.createRange&&document.selection.createRange().pasteHTML(f),this.markUpdated()},_insertCol0:function(e){var t=e.target.ancestor(i.COLUMN,!0),n=this.get("host"),r=t.getData("attr"),s=t.getData("attrValue"),o="";e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),r=="class"?s+=" atto-editor-columnborder":o='class="atto-editor-columnborder"';var u=s.split(",");if(u.length>1)var a="<div><"+t.getData("tagname")+" "+o+" "+r+'="'+u[0]+'" >Column 1'+"</"+t.getData("tagname")+">"+"<"+t.getData("tagname")+" "+o+" "+r+'="'+u[1]+'" >Column 2'+"</"+t.getData("tagname")+'><div style="clear:both"></div></div></div><br><p><br></p>';else var a="<"+t.getData("tagname")+" "+o+" "+r+'="'+u[0]+'" >Column'+"</"+t.getData("tagname")+'><div style="clear:both"></div></div><br><p><br></p>';var f,l;window.getSelection&&window.getSelection().getRangeAt?(f=window.getSelection().getRangeAt(0),l=f.createContextualFragment(a),f.insertNode(l)):document.selection&&document.selection.createRange&&document.selection.createRange().pasteHTML(a),this.markUpdated()},_getDialogueContent:function(){var t=e.HanCSS={COLUMN:"atto_qmulcolumns_column",MAP:"atto_qmulcolumns_map"},t=e.Handlebars.compile(s),n=e.Node.create(t({styles:this.get("styles"),CSS:r}));return n.delegate("click",this._insertCol,i.COLUMN,this),n.delegate("key",this._insertCol,"32",i.COLUMN,this),n}},{ATTRS:{styles:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
