function dontmigrate(t){$("#migration_alert").hide(),t.close()}function lightBoxCloseButton(t){$("body").append('<div id="tii_close_bar"><a class="tii_close_link" href="#">'+M.str.turnitintooltwo.closebutton+"</a></div>")}function displayMigrationModal(){$("#migrate_type").data("turnitintoolid")!=$("#migrate_type").data("lastasked")&&($.colorbox({width:550,height:600,inline:!0,opacity:"0.7",href:"#migration_alert",onLoad:function(){$("#asktomigrate").show(),lightBoxCloseButton(),$(".tii_close_link").click($.proxy(dontmigrate,null,$.colorbox))},onCleanup:function(){$("#tii_close_bar").remove(),$("#migration_alert").hide()}}),$("#migration_alert").show()),2==$("#migrate_type").data("migratetype")&&($("#asktomigrate").hide(),$("#migrating").show(),migrate($("#migrate_type").data("courseid"),$("#migrate_type").data("turnitintoolid")))}function migrate(t,o){$.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"begin_migration",courseid:t,turnitintoolid:o,sesskey:M.cfg.sesskey},success:function(t){$.colorbox&&$.colorbox.close(),$("#migration_alert").hide(),window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+t.id+"&migrated=1"},error:function(t){var o=t.responseJSON;$.colorbox&&$.colorbox.close(),$("#migration_alert").hide(),$("#turnitintool_style").prepend('<div id="full-error" class="box generalbox noticebox">'+o.error+" "+o.message+"</div>"),o.hasOwnProperty("trace")&&(console.error(o.message),console.error(JSON.stringify(o.trace,null,4)))}})}$(document).ready(function(){$.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"check_migrated",turnitintoolid:$("#migrate_type").data("turnitintoolid"),sesskey:M.cfg.sesskey},success:function(t){t.migrated===!0?window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+t.v2id:(displayMigrationModal(),$(".dontmigrate_link").click($.proxy(dontmigrate,null,$.colorbox)))}})}),$(".migrate_link").on("click",function(){$("#asktomigrate").hide(),$("#migrating").show(),migrate($(this).data("courseid"),$(this).data("turnitintoolid"))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR1cm5pdGludG9vbHR3b19taWdyYXRpb25fdG9vbC5qcyJdLCJuYW1lcyI6WyJkb250bWlncmF0ZSIsImNiIiwiJCIsImhpZGUiLCJjbG9zZSIsImxpZ2h0Qm94Q2xvc2VCdXR0b24iLCJhcHBlbmQiLCJNIiwic3RyIiwidHVybml0aW50b29sdHdvIiwiY2xvc2VidXR0b24iLCJkaXNwbGF5TWlncmF0aW9uTW9kYWwiLCJkYXRhIiwiY29sb3Jib3giLCJ3aWR0aCIsImhlaWdodCIsImlubGluZSIsIm9wYWNpdHkiLCJocmVmIiwib25Mb2FkIiwic2hvdyIsImNsaWNrIiwicHJveHkiLCJvbkNsZWFudXAiLCJyZW1vdmUiLCJtaWdyYXRlIiwiY291cnNlaWQiLCJ0dXJuaXRpbnRvb2xpZCIsImFqYXgiLCJkYXRhVHlwZSIsInR5cGUiLCJ1cmwiLCJjZmciLCJ3d3dyb290IiwiYWN0aW9uIiwic2Vzc2tleSIsInN1Y2Nlc3MiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImlkIiwiZXJyb3IiLCJyZXNwb25zZUpTT04iLCJwcmVwZW5kIiwibWVzc2FnZSIsImhhc093blByb3BlcnR5IiwiY29uc29sZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0cmFjZSIsImRvY3VtZW50IiwicmVhZHkiLCJtaWdyYXRlZCIsInYyaWQiLCJvbiIsInRoaXMiXSwibWFwcGluZ3MiOiJBQThCQSxRQUFTQSxhQUFZQyxHQUNqQkMsRUFBRSxvQkFBb0JDLE9BQ3RCRixFQUFHRyxRQUdQLFFBQVNDLHFCQUFvQkosR0FDekJDLEVBQUUsUUFBUUksT0FBTyw4REFBZ0VDLEVBQUVDLElBQUlDLGdCQUFnQkMsWUFBYyxjQUl6SCxRQUFTQyx5QkFFRFQsRUFBRSxpQkFBaUJVLEtBQUssbUJBQXFCVixFQUFFLGlCQUFpQlUsS0FBSyxlQUNyRVYsRUFBRVcsVUFBVUMsTUFBTyxJQUFLQyxPQUFRLElBQUtDLFFBQU8sRUFBTUMsUUFBUyxNQUFPQyxLQUFLLG1CQUNuRUMsT0FBUSxXQUNKakIsRUFBRSxpQkFBaUJrQixPQUNuQmYsc0JBRUFILEVBQUUsbUJBQW1CbUIsTUFBTW5CLEVBQUVvQixNQUFNdEIsWUFBYSxLQUFNRSxFQUFFVyxZQUU1RFUsVUFBVSxXQUNOckIsRUFBRSxrQkFBa0JzQixTQUNwQnRCLEVBQUUsb0JBQW9CQyxVQUk5QkQsRUFBRSxvQkFBb0JrQixRQUdvQixHQUExQ2xCLEVBQUUsaUJBQWlCVSxLQUFLLGlCQUN4QlYsRUFBRSxpQkFBaUJDLE9BQ25CRCxFQUFFLGNBQWNrQixPQUVoQkssUUFBUXZCLEVBQUUsaUJBQWlCVSxLQUFLLFlBQWFWLEVBQUUsaUJBQWlCVSxLQUFLLG9CQUk3RSxRQUFTYSxTQUFRQyxFQUFVQyxHQUN2QnpCLEVBQUUwQixNQUNFQyxTQUFZLE9BQ1pDLEtBQVEsT0FDUkMsSUFBS3hCLEVBQUV5QixJQUFJQyxRQUFVLGdDQUNyQnJCLE1BQVNzQixPQUFRLGtCQUFtQlIsU0FBVUEsRUFBVUMsZUFBZ0JBLEVBQWdCUSxRQUFTNUIsRUFBRXlCLElBQUlHLFNBQ3ZHQyxRQUFTLFNBQVN4QixHQUNWVixFQUFFVyxVQUNGWCxFQUFFVyxTQUFTVCxRQUVmRixFQUFFLG9CQUFvQkMsT0FDdEJrQyxPQUFPQyxTQUFTcEIsS0FBT1gsRUFBRXlCLElBQUlDLFFBQVUsb0NBQW9DckIsRUFBSzJCLEdBQUcsZUFFdkZDLE1BQU8sU0FBU0EsR0FDWixHQUFJNUIsR0FBTzRCLEVBQU1DLFlBQ2J2QyxHQUFFVyxVQUNGWCxFQUFFVyxTQUFTVCxRQUVmRixFQUFFLG9CQUFvQkMsT0FDdEJELEVBQUUsdUJBQ0d3QyxRQUFRLHlEQUEyRDlCLEVBQUs0QixNQUFRLElBQU01QixFQUFLK0IsUUFBVSxVQUd0Ry9CLEVBQUtnQyxlQUFlLFdBQ3BCQyxRQUFRTCxNQUFNNUIsRUFBSytCLFNBQ25CRSxRQUFRTCxNQUFNTSxLQUFLQyxVQUFVbkMsRUFBS29DLE1BQU8sS0FBTSxRQTVGL0Q5QyxFQUFFK0MsVUFBVUMsTUFBTSxXQUdkaEQsRUFBRTBCLE1BQ0VDLFNBQVksT0FDWkMsS0FBUSxPQUNSQyxJQUFPeEIsRUFBRXlCLElBQUlDLFFBQVUsZ0NBQ3ZCckIsTUFDSXNCLE9BQVEsaUJBQ1JQLGVBQWdCekIsRUFBRSxpQkFBaUJVLEtBQUssa0JBQ3hDdUIsUUFBUzVCLEVBQUV5QixJQUFJRyxTQUVuQkMsUUFBVyxTQUFTeEIsR0FDWkEsRUFBS3VDLFlBQWEsRUFDbEJkLE9BQU9DLFNBQVNwQixLQUFPWCxFQUFFeUIsSUFBSUMsUUFBVSxvQ0FBb0NyQixFQUFLd0MsTUFFaEZ6Qyx3QkFFQVQsRUFBRSxxQkFBcUJtQixNQUFNbkIsRUFBRW9CLE1BQU10QixZQUFhLEtBQU1FLEVBQUVXLGlCQU0xRVgsRUFBRSxpQkFBaUJtRCxHQUFHLFFBQVMsV0FDM0JuRCxFQUFFLGlCQUFpQkMsT0FDbkJELEVBQUUsY0FBY2tCLE9BQ2hCSyxRQUFRdkIsRUFBRW9ELE1BQU0xQyxLQUFLLFlBQWFWLEVBQUVvRCxNQUFNMUMsS0FBSyIsImZpbGUiOiJ0dXJuaXRpbnRvb2x0d29fbWlncmF0aW9uX3Rvb2wubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcblxuICAgIC8vIENoZWNrIHdoZXRoZXIgdGhpcyBhc3NpZ25tZW50IGhhcyBiZWVuIG1pZ3JhdGVkIGluIHRoaXMgc2Vzc2lvbiBhbmQgcmVkaXJlY3QgaWYgc28uXG4gICAgJC5hamF4KHtcbiAgICAgICAgXCJkYXRhVHlwZVwiOiAnanNvbicsXG4gICAgICAgIFwidHlwZVwiOiBcIlBPU1RcIixcbiAgICAgICAgXCJ1cmxcIjogTS5jZmcud3d3cm9vdCArIFwiL21vZC90dXJuaXRpbnRvb2x0d28vYWpheC5waHBcIixcbiAgICAgICAgXCJkYXRhXCI6IHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJjaGVja19taWdyYXRlZFwiLFxuICAgICAgICAgICAgdHVybml0aW50b29saWQ6ICQoXCIjbWlncmF0ZV90eXBlXCIpLmRhdGEoXCJ0dXJuaXRpbnRvb2xpZFwiKSxcbiAgICAgICAgICAgIHNlc3NrZXk6IE0uY2ZnLnNlc3NrZXlcbiAgICAgICAgfSxcbiAgICAgICAgXCJzdWNjZXNzXCI6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLm1pZ3JhdGVkID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBNLmNmZy53d3dyb290ICsgXCIvbW9kL3R1cm5pdGludG9vbHR3by92aWV3LnBocD9pZD1cIitkYXRhLnYyaWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlNaWdyYXRpb25Nb2RhbCgpO1xuXG4gICAgICAgICAgICAgICAgJCgnLmRvbnRtaWdyYXRlX2xpbmsnKS5jbGljaygkLnByb3h5KGRvbnRtaWdyYXRlLCBudWxsLCAkLmNvbG9yYm94KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuXG4kKCcubWlncmF0ZV9saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgJCgnI2Fza3RvbWlncmF0ZScpLmhpZGUoKTtcbiAgICAkKCcjbWlncmF0aW5nJykuc2hvdygpO1xuICAgIG1pZ3JhdGUoJCh0aGlzKS5kYXRhKFwiY291cnNlaWRcIiksICQodGhpcykuZGF0YShcInR1cm5pdGludG9vbGlkXCIpKTtcbn0pO1xuXG5mdW5jdGlvbiBkb250bWlncmF0ZShjYikge1xuICAgICQoJyNtaWdyYXRpb25fYWxlcnQnKS5oaWRlKCk7XG4gICAgY2IuY2xvc2UoKTtcbn1cblxuZnVuY3Rpb24gbGlnaHRCb3hDbG9zZUJ1dHRvbihjYikge1xuICAgICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9XCJ0aWlfY2xvc2VfYmFyXCI+PGEgY2xhc3M9XCJ0aWlfY2xvc2VfbGlua1wiIGhyZWY9XCIjXCI+JyArIE0uc3RyLnR1cm5pdGludG9vbHR3by5jbG9zZWJ1dHRvbiArICc8L2E+PC9kaXY+Jyk7XG59XG5cblxuZnVuY3Rpb24gZGlzcGxheU1pZ3JhdGlvbk1vZGFsKCkge1xuICAgIC8vIE9ubHkgZGlzcGxheSB0aGUgbW9kYWwgZHVyaW5nIGEgbWFudWFsIG1pZ3JhdGlvbi5cbiAgICBpZiAoJCgnI21pZ3JhdGVfdHlwZScpLmRhdGEoXCJ0dXJuaXRpbnRvb2xpZFwiKSAhPSAkKFwiI21pZ3JhdGVfdHlwZVwiKS5kYXRhKFwibGFzdGFza2VkXCIpKSB7XG4gICAgICAgICQuY29sb3Jib3goe3dpZHRoOiA1NTAsIGhlaWdodDogNjAwLCBpbmxpbmU6dHJ1ZSwgb3BhY2l0eTogXCIwLjdcIiwgaHJlZjpcIiNtaWdyYXRpb25fYWxlcnRcIixcbiAgICAgICAgICAgIG9uTG9hZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJCgnI2Fza3RvbWlncmF0ZScpLnNob3coKTtcbiAgICAgICAgICAgICAgICBsaWdodEJveENsb3NlQnV0dG9uKCk7XG5cbiAgICAgICAgICAgICAgICAkKCcudGlpX2Nsb3NlX2xpbmsnKS5jbGljaygkLnByb3h5KGRvbnRtaWdyYXRlLCBudWxsLCAkLmNvbG9yYm94KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25DbGVhbnVwOmZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoJyN0aWlfY2xvc2VfYmFyJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLnNob3coKTtcbiAgICB9XG5cbiAgICBpZiAoJCgnI21pZ3JhdGVfdHlwZScpLmRhdGEoXCJtaWdyYXRldHlwZVwiKSA9PSAyKSB7XG4gICAgICAgICQoJyNhc2t0b21pZ3JhdGUnKS5oaWRlKCk7XG4gICAgICAgICQoJyNtaWdyYXRpbmcnKS5zaG93KCk7XG5cbiAgICAgICAgbWlncmF0ZSgkKFwiI21pZ3JhdGVfdHlwZVwiKS5kYXRhKFwiY291cnNlaWRcIiksICQoXCIjbWlncmF0ZV90eXBlXCIpLmRhdGEoXCJ0dXJuaXRpbnRvb2xpZFwiKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBtaWdyYXRlKGNvdXJzZWlkLCB0dXJuaXRpbnRvb2xpZCkge1xuICAgICQuYWpheCh7XG4gICAgICAgIFwiZGF0YVR5cGVcIjogJ2pzb24nLFxuICAgICAgICBcInR5cGVcIjogXCJQT1NUXCIsXG4gICAgICAgIHVybDogTS5jZmcud3d3cm9vdCArIFwiL21vZC90dXJuaXRpbnRvb2x0d28vYWpheC5waHBcIixcbiAgICAgICAgXCJkYXRhXCI6IHthY3Rpb246IFwiYmVnaW5fbWlncmF0aW9uXCIsIGNvdXJzZWlkOiBjb3Vyc2VpZCwgdHVybml0aW50b29saWQ6IHR1cm5pdGludG9vbGlkLCBzZXNza2V5OiBNLmNmZy5zZXNza2V5fSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgaWYgKCQuY29sb3Jib3gpIHtcbiAgICAgICAgICAgICAgICAkLmNvbG9yYm94LmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKCcjbWlncmF0aW9uX2FsZXJ0JykuaGlkZSgpO1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBNLmNmZy53d3dyb290ICsgXCIvbW9kL3R1cm5pdGludG9vbHR3by92aWV3LnBocD9pZD1cIitkYXRhLmlkK1wiJm1pZ3JhdGVkPTFcIjtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGVycm9yLnJlc3BvbnNlSlNPTjtcbiAgICAgICAgICAgIGlmICgkLmNvbG9yYm94KSB7XG4gICAgICAgICAgICAgICAgJC5jb2xvcmJveC5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLmhpZGUoKTtcbiAgICAgICAgICAgICQoJyN0dXJuaXRpbnRvb2xfc3R5bGUnKVxuICAgICAgICAgICAgICAgIC5wcmVwZW5kKCc8ZGl2IGlkPVwiZnVsbC1lcnJvclwiIGNsYXNzPVwiYm94IGdlbmVyYWxib3ggbm90aWNlYm94XCI+JyArIGRhdGEuZXJyb3IgKyAnICcgKyBkYXRhLm1lc3NhZ2UgKyAnPC9kaXY+Jyk7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgYSBzdGFjayB0cmFjZSBpbmNsdWRlZC5cbiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KCd0cmFjZScpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoSlNPTi5zdHJpbmdpZnkoZGF0YS50cmFjZSwgbnVsbCwgNCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XG4iXX0=
