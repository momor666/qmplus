define(["jquery","core/str"],function(a,b){return{init:function(c){var d=!1,e=!1,f={},g=function(b){for(var c in b){var d=b[c],e=""+a("#id_s_collaborate_"+d).val().trim();if(""===e)return!1}return!0},h=function(){var a=["restserver","restkey","restsecret"];return g(a)},i=function(){var a=["server","username","password"];return g(a)},j=function(b,c,d){var e=f[b],g=a("#api_diag .noticetemplate_"+c).children().first().clone();a(g).addClass(d),a(g).html('<span class="api-connection-msg">'+e+"</span>"),a("#api_diag .api-connection-status").empty(),a("#api_diag .api-connection-status").append(a(g))},k=function(){j("verifyingapi","message","spinner");var b;b=h()?{server:a("#id_s_collaborate_restserver").val().trim(),restkey:a("#id_s_collaborate_restkey").val().trim(),restsecret:a("#id_s_collaborate_restsecret").val()}:{server:a("#id_s_collaborate_server").val().trim(),username:a("#id_s_collaborate_username").val().trim(),password:a("#id_s_collaborate_password").val()},b.contextid=c,a.ajax({url:M.cfg.wwwroot+"/mod/collaborate/testapi.php",context:document.body,data:b,success:function(a){a.success?d?j("connectionverifiedchanged","success"):j("connectionverified","success"):j("connectionfailed","problem")},error:function(){j("connectionfailed","problem")}})},l=function(){a(".api_diag_btn").click(function(a){a.preventDefault(),k()})},m=function(){var b="#id_s_collaborate_server, #id_s_collaborate_username, #id_s_collaborate_password";a(b).keypress(function(){d=!0})};b.get_strings([{key:"connectionfailed",component:"mod_collaborate"},{key:"connectionverified",component:"mod_collaborate"},{key:"verifyingapi",component:"mod_collaborate"},{key:"connectionstatusunknown",component:"mod_collaborate"}]).then(function(b){f.connectionfailed=b[0],f.connectionverified=b[1],f.verifyingapi=b[2],f.connectionstatusunknown=b[3],e||j("connectionstatusunknown","message"),m(),l(),""===i()&&""===h()||k(),(/Edge\/\d./i.test(navigator.userAgent)||/MSIE/i.test(navigator.userAgent)||/Trident/i.test(navigator.userAgent))&&a('fieldset[disabled="true"] input').attr("disabled","true"),h()||a(".soapapisettings").css("display","block"),e=!0})}}});