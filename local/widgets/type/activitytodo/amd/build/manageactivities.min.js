define(["jquery","core/ajax","core/notification"],function(a,b,c){function d(a){var b=a.closest(".todoitem");return b.length?b.data("cmid"):null}function e(e){e.preventDefault();var f=a(e.currentTarget),g=d(f);if(g){var h=b.call([{methodname:"local_activitytodo_remove",args:{cmid:g}}]);h[0].done(function(){var a=f.closest(".widget-item"),b=a.find(".activityname").text(),d=f.data("note").replace(/"/g,"&quot;"),e=f.data("duedate"),h=M.util.get_string("todoitemremoved","local_activitytodo",b);h+=' <a href="#" class="widget-activitytodo-undoremove" data-cmid="'+g+'" data-note="'+d+'"  data-duedate="'+e+'" >'+M.util.get_string("undo","local_activitytodo")+"</a>",c.addNotification({type:"success",message:h}),a.remove()})}}function f(c){c.preventDefault();var d=a(c.currentTarget),e=d.data("cmid"),f=d.data("note"),g=d.data("duedate"),h=[{methodname:"local_activitytodo_add",args:{cmid:e}}];f&&h.push({methodname:"local_activitytodo_update_note",args:{cmid:e,note:f}}),g&&h.push({methodname:"local_activitytodo_update_duedate",args:{cmid:e,duedate:g}});var i=b.call(h);a.when.apply(a,i).done(function(){window.location.reload(!0)})}return{init:function(){var b=a(".widgettype-activitytodo");b.on("click",".todoremove",e),a("body").on("click",".widget-activitytodo-undoremove",f)}}});