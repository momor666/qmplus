define(["jquery","core/log"],function(a,b){var c=function(b){var c,e=window.navigator.userAgent;(e.indexOf("MSIE ")||e.indexOf("Trident/"))&&(b=a("#toc-searchables").find("li").clone(!0));var f=a("#toc-search-input"),g=a("#toc-search-results"),h=f.val();if(h=d(h),0===h.length)g.html(""),f.removeClass("state-active");else{f.addClass("state-active");var i=[];for(c=0;c<b.length;c++){var j=b[c];d(a(j).text()).indexOf(h)>-1&&i.push(j)}g.html(i)}},d=function(a){return a=a.trim().toLowerCase()},e=function(b,c){var e;if("all"==b)var f=0;if("my"==b)var f=a("#userid").data("userid");c=d(c);var g=a(".searchbox .searchresults"),h=a(".searchbox .coursesearch"),i={userid:f,search:c};if(0===c.length)g.html(""),h.removeClass("state-active");else{var j=new Array;a.ajax({url:M.cfg.wwwroot+"/theme/qmul/lib/searchcourses.php",context:document.body,method:"POST",data:i}).done(function(b){for(e=0;e<b.length;e++){var d=b[e],f=new RegExp("("+c+")","gi"),h=d.fullname.replace(f,"<span>$1</span>"),i="<li data-id='"+d.id+"'>";i+="<a href='"+d.url+"'>",i+="<div class='coursename'>",i+=h,i+="</div>",i+="</a>",i+="</li>",j.push(i)}g.html(j),a(".searchbox .searchresults li:first-child").addClass("selected")})}};return{init:function(){a(document).ready(function(){var b=a("#toc-searchables").find("li").clone(!0);a(".courseheader").on("keyup","#toc-search-input",function(){c(b)}),a("body").on("click",".searchbox .searchoptions > div",function(){a(this).hasClass("active")||(a(".searchbox .searchoptions > div").toggleClass("active"),a(".searchcontainer .searchbox .coursesearch").keyup())}),a("#mod_quiz_navblock.block .header").on("click",function(){a("#mod_quiz_navblock.block .header").toggleClass("minimize"),a("#mod_quiz_navblock.block .card-block").slideToggle()});var d;a(".searchcontainer .options .allmodules").find("li").clone(!0),a(".searchcontainer .options .mymodules").find("li").clone(!0);a(".searchcontainer").on("keyup",".searchbox .coursesearch",function(b){if(clearTimeout(d),this.value.length<3)return void(8==b.which&&a(".searchbox .searchresults").html(""));if(40==b.which){var c=a(".searchbox .searchresults li.selected"),f=c.next();return void(f.length>0&&(f.addClass("selected"),c.removeClass("selected")))}if(38==b.which){var c=a(".searchbox .searchresults li.selected"),g=c.prev();return void(g.length>0&&(g.addClass("selected"),c.removeClass("selected")))}if(13!=b.which){var h=this.value,i=a(".searchbox .searchoptions div.active").data("type");if("my"==i);else;d=setTimeout(function(){e(i,h)},400)}else{var j=a(".searchbox .searchresults li.selected a");if(j.length>0){var k=j.attr("href");window.location.href=k}}})})}}});